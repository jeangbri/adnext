(()=>{var e={};e.id=2100,e.ids=[2100],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},47849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},43654:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>p,originalPathname:()=>u,pages:()=>l,routeModule:()=>m,tree:()=>c});var a=r(28090),s=r(79409),n=r(31522),i=r.n(n),o=r(41305),d={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>o[e]);r.d(t,d);let c=["",{children:["(dashboard)",{children:["logs",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,38784)),"C:\\Users\\jeang\\OneDrive\\Desktop\\adnext\\apps\\web\\src\\app\\(dashboard)\\logs\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,63470)),"C:\\Users\\jeang\\OneDrive\\Desktop\\adnext\\apps\\web\\src\\app\\(dashboard)\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,70111,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(r.bind(r,13840)),"C:\\Users\\jeang\\OneDrive\\Desktop\\adnext\\apps\\web\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,70111,23)),"next/dist/client/components/not-found-error"]}],l=["C:\\Users\\jeang\\OneDrive\\Desktop\\adnext\\apps\\web\\src\\app\\(dashboard)\\logs\\page.tsx"],u="/(dashboard)/logs/page",p={require:r,loadChunk:()=>Promise.resolve()},m=new a.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/(dashboard)/logs/page",pathname:"/logs",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},57409:(e,t,r)=>{let a={"67ec2a3b5879da03fd9db50f251cecdfe825c359":()=>Promise.resolve().then(r.bind(r,56087)).then(e=>e.deleteProject),"7a8a07ed673e87719a224ba5bdd94c5abf5790df":()=>Promise.resolve().then(r.bind(r,56087)).then(e=>e.createProject),"7d8e4dd9996424d0e268f2b3af549e67be85e477":()=>Promise.resolve().then(r.bind(r,56087)).then(e=>e.updatePageProject),f8668bd5f71af427a636b6031eb02965154b8feb:()=>Promise.resolve().then(r.bind(r,56087)).then(e=>e.getProjects),"6511aec7141895e8bedebb549690cdc948a691f5":()=>Promise.resolve().then(r.bind(r,80736)).then(e=>e.setContext)};async function s(e,...t){return(await a[e]()).apply(null,t)}e.exports={"67ec2a3b5879da03fd9db50f251cecdfe825c359":s.bind(null,"67ec2a3b5879da03fd9db50f251cecdfe825c359"),"7a8a07ed673e87719a224ba5bdd94c5abf5790df":s.bind(null,"7a8a07ed673e87719a224ba5bdd94c5abf5790df"),"7d8e4dd9996424d0e268f2b3af549e67be85e477":s.bind(null,"7d8e4dd9996424d0e268f2b3af549e67be85e477"),f8668bd5f71af427a636b6031eb02965154b8feb:s.bind(null,"f8668bd5f71af427a636b6031eb02965154b8feb"),"6511aec7141895e8bedebb549690cdc948a691f5":s.bind(null,"6511aec7141895e8bedebb549690cdc948a691f5")}},38146:()=>{},38784:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>b,dynamic:()=>m});var a=r(71002),s=r(38588),n=r(11455),i=r(61242),o=r(33573);r(57680);var d=r(69481),c=r(45482);let l=(0,d.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-500 text-white hover:bg-green-600"}},defaultVariants:{variant:"default"}});function u({className:e,variant:t,...r}){return a.jsx("div",{className:(0,c.cn)(l({variant:t}),e),...r})}var p=r(65702);let m="force-dynamic";async function b({searchParams:e}){let t=(0,i.e)(),{data:{user:r}}=await t.auth.getUser();r||(0,o.redirect)("/entrar");let d=await (0,n.A)(r.id,r.email||""),c=await (0,p._)(),l=[];e.pageId&&"ALL"!==e.pageId?l=[e.pageId]:c?.pageIds&&c.pageIds.length>0&&(l=c.pageIds);let m=l.length>0?{pageId:{in:l}}:{page:{workspaceId:d.id}},b={page:{workspaceId:d.id},...m},g={page:{workspaceId:d.id},...m};e.status&&"ALL"!==e.status&&(b.status=e.status);let[h,x]=await Promise.all([s._.messageLog.findMany({where:b,orderBy:{createdAt:"desc"},take:50,include:{contact:!0,page:!0}}),e.status&&"ALL"!==e.status?[]:s._.commentEvent.findMany({where:g,orderBy:{createdAt:"desc"},take:50,include:{page:!0}})]),f=[...h.map(e=>({id:e.id,type:"MESSAGE",direction:e.direction,source:e.actionType?"AUTOMATION":"WEBHOOK",content:e.incomingText||(e.actionType?`Envio: ${e.actionType}`:"-"),status:e.status,error:e.error,createdAt:e.createdAt,pageName:e.page.pageName,contactName:e.contact?.firstName||e.contact?.psid||"Desconhecido",raw:e})),...x.map(e=>({id:e.id,type:"COMMENT",direction:"IN",source:"WEBHOOK_FEED",content:e.message||"[Sem texto]",status:"RECEIVED",error:null,createdAt:e.createdAt,pageName:e.page.pageName,contactName:e.fromUserId||"Usu\xe1rio Facebook",raw:e}))].sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()).slice(0,50);return(0,a.jsxs)("div",{className:"space-y-6",children:[a.jsx("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-2xl font-bold tracking-tight text-white",children:"Logs & Eventos"}),a.jsx("p",{className:"text-muted-foreground",children:"Hist\xf3rico unificado de mensagens e coment\xe1rios."})]})}),(0,a.jsxs)("div",{className:"border border-white/10 rounded-lg bg-zinc-950/50 backdrop-blur overflow-hidden",children:[(0,a.jsxs)("table",{className:"w-full text-left text-sm",children:[a.jsx("thead",{className:"bg-zinc-900/50 text-zinc-400 font-medium border-b border-white/5",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{className:"px-6 py-4",children:"Data"}),a.jsx("th",{className:"px-6 py-4",children:"P\xe1gina"}),a.jsx("th",{className:"px-6 py-4",children:"Origem"}),a.jsx("th",{className:"px-6 py-4",children:"Tipo"}),a.jsx("th",{className:"px-6 py-4",children:"Conte\xfado"}),a.jsx("th",{className:"px-6 py-4",children:"Status"})]})}),a.jsx("tbody",{className:"divide-y divide-white/5 text-zinc-300",children:f.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-white/5 transition-colors",children:[a.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-xs text-zinc-400",children:new Date(e.createdAt).toLocaleString("pt-BR")}),a.jsx("td",{className:"px-6 py-4 text-xs",children:e.pageName}),a.jsx("td",{className:"px-6 py-4",children:a.jsx("div",{className:"flex flex-col",children:a.jsx("span",{className:"text-sm",children:e.contactName})})}),a.jsx("td",{className:"px-6 py-4",children:a.jsx(u,{variant:"outline",className:`
                                        ${"COMMENT"===e.type?"text-yellow-400 bg-yellow-400/10 border-yellow-400/20":""}
                                        ${"MESSAGE"===e.type&&"IN"===e.direction?"text-blue-400 bg-blue-400/10 border-blue-400/20":""}
                                        ${"MESSAGE"===e.type&&"OUT"===e.direction?"text-purple-400 bg-purple-400/10 border-purple-400/20":""}
                                    `,children:"COMMENT"===e.type?"COMENT\xc1RIO":"IN"===e.direction?"MSG RECEBIDA":"MSG ENVIADA"})}),a.jsx("td",{className:"px-6 py-4 max-w-xs truncate",title:e.content,children:e.content}),a.jsx("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[a.jsx(u,{variant:"secondary",className:"ERROR"===e.status||"FAILED"===e.status?"bg-red-500/10 text-red-500":"MATCHED"===e.status||"SENT"===e.status||"RECEIVED"===e.status?"bg-green-500/10 text-green-500":"bg-zinc-800 text-zinc-400",children:e.status}),e.error&&a.jsx("span",{className:"text-[10px] text-red-400 max-w-[150px] truncate",children:e.error})]})})]},e.id))})]}),0===f.length&&a.jsx("div",{className:"p-12 text-center text-zinc-500",children:"Nenhum log encontrado."})]})]})}},56087:(e,t,r)=>{"use strict";r.r(t),r.d(t,{createProject:()=>d,deleteProject:()=>l,getProjects:()=>o,updatePageProject:()=>c});var a=r(48437);r(69821);var s=r(56685),n=r(21840),i=r(52841);async function o(){let e=await (0,n.createClient)(),{data:{user:t}}=await e.auth.getUser();return t?(!await s.prisma.user.findUnique({where:{id:t.id}})&&t.email&&await s.prisma.user.create({data:{id:t.id,email:t.email}}).catch(()=>{}),await s.prisma.project.findMany({where:{userId:t.id},include:{pages:{select:{pageId:!0,pageName:!0,isActive:!0}},_count:{select:{pages:!0}}},orderBy:{createdAt:"desc"}})):[]}async function d(e){let t=await (0,n.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)throw Error("Unauthorized");let a=e.get("name");if(!a||a.length<3)throw Error("Nome inv\xe1lido (min 3 chars)");let o=a.toLowerCase().replace(/[^a-z0-9]+/g,"-")+"-"+Math.floor(1e4*Math.random());try{return await s.prisma.project.create({data:{userId:r.id,name:a,slug:o}}),(0,i.revalidatePath)("/projects"),{success:!0}}catch(e){return console.error(e),{error:"Erro ao criar projeto"}}}async function c(e,t){let r=await (0,n.createClient)(),{data:{user:a}}=await r.auth.getUser();if(!a)throw Error("Unauthorized");let o=await s.prisma.project.findUnique({where:{id:t}});if(!o||o.userId!==a.id)throw Error("Projeto inv\xe1lido ou sem permiss\xe3o");return await s.prisma.messengerPage.update({where:{pageId:e},data:{projectId:t,userId:a.id}}),(0,i.revalidatePath)("/settings/integracoes"),{success:!0}}async function l(e){let t=await (0,n.createClient)(),{data:{user:r}}=await t.auth.getUser();if(!r)throw Error("Unauthorized");let a=await s.prisma.project.findUnique({where:{id:e},include:{_count:{select:{pages:!0}}}});if(!a||a.userId!==r.id)throw Error("Projeto n\xe3o encontrado");if(a._count.pages>0)throw Error("N\xe3o \xe9 poss\xedvel deletar projeto com p\xe1ginas associadas.");await s.prisma.project.delete({where:{id:e}}),(0,i.revalidatePath)("/projects")}(0,r(64601).ensureServerEntryExports)([o,d,c,l]),(0,a.createActionProxy)("f8668bd5f71af427a636b6031eb02965154b8feb",o),(0,a.createActionProxy)("7a8a07ed673e87719a224ba5bdd94c5abf5790df",d),(0,a.createActionProxy)("7d8e4dd9996424d0e268f2b3af549e67be85e477",c),(0,a.createActionProxy)("67ec2a3b5879da03fd9db50f251cecdfe825c359",l)},56685:(e,t,r)=>{"use strict";r.d(t,{prisma:()=>s});var a=r(53524);let s=globalThis.prisma??new a.PrismaClient({log:["error","warn"]})},38588:(e,t,r)=>{"use strict";r.d(t,{_:()=>s});var a=r(53524);let s=globalThis.prisma??new a.PrismaClient({log:["error","warn"]})},21840:(e,t,r)=>{"use strict";r.d(t,{createClient:()=>n});var a=r(43114),s=r(6235);function n(){let e=(0,s.cookies)(),t="https://fmxdqpukjuzhiseyobvz.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZteGRxcHVranV6aGlzZXlvYnZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2Mjk4MjYsImV4cCI6MjA4NTIwNTgyNn0.bXEJnoTUSzAVDwQNwwiG1gmFc0rfK5M9xbKFMRb48BY";return t&&r||(console.warn("⚠️ Missing Supabase environment variables. Using fallback for build."),"build"!==process.env.npm_lifecycle_event&&t)?(0,a.createServerClient)(t||"",r||"",{cookies:{get:t=>e.get(t)?.value,set(t,r,a){try{e.set({name:t,value:r,...a})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}}):(0,a.createServerClient)(t||"https://placeholder.supabase.co",r||"placeholder",{cookies:{get:()=>void 0,set:()=>{},remove:()=>{}}})}},61242:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});var a=r(51441),s=r(97705);function n(){let e=(0,s.cookies)(),t="https://fmxdqpukjuzhiseyobvz.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZteGRxcHVranV6aGlzZXlvYnZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2Mjk4MjYsImV4cCI6MjA4NTIwNTgyNn0.bXEJnoTUSzAVDwQNwwiG1gmFc0rfK5M9xbKFMRb48BY";return t&&r||(console.warn("⚠️ Missing Supabase environment variables. Using fallback for build."),"build"!==process.env.npm_lifecycle_event&&t)?(0,a.lx)(t||"",r||"",{cookies:{get:t=>e.get(t)?.value,set(t,r,a){try{e.set({name:t,value:r,...a})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}}):(0,a.lx)(t||"https://placeholder.supabase.co",r||"placeholder",{cookies:{get:()=>void 0,set:()=>{},remove:()=>{}}})}},65702:(e,t,r)=>{"use strict";r.d(t,{_:()=>i});var a=r(97705),s=r(38588),n=r(61242);async function i(){let e=await (0,n.e)(),{data:{user:t}}=await e.auth.getUser();if(!t)return null;let r=(0,a.cookies)(),i=r.get("adnext_project")?.value,o=r.get("adnext_page")?.value;if(!i)return{userId:t.id,projectId:null,pageId:null,pageIds:[]};try{let e=await s._.project.findUnique({where:{id:i},include:{pages:{select:{pageId:!0}}}});if(!e||e.userId!==t.id)return{userId:t.id,projectId:null,pageId:null,pageIds:[]};let r=e.pages.map(e=>e.pageId),a=o;return o&&"ALL"!==o&&!r.includes(o)&&(a="ALL"),{userId:t.id,projectId:i,pageId:a||"ALL",pageIds:"ALL"!==a&&a?[a]:r}}catch(e){return console.error("Scope Error",e),{userId:t.id,projectId:null,pageId:null,pageIds:[]}}}},45482:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var a=r(76031),s=r(80817);function n(...e){return(0,s.m6)((0,a.W)(e))}},11455:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(38588);async function s(e,t){let r=await a._.workspaceMember.findFirst({where:{userId:e},include:{workspace:!0}});if(r)return r.workspace;let s=await a._.user.findUnique({where:{id:e}});if(!s){if(t)s=await a._.user.create({data:{id:e,email:t}});else throw Error("User not found and no email provided")}return await a._.workspace.create({data:{name:"Meu Workspace",ownerId:e,members:{create:{userId:e,role:"OWNER"}},workflowFolders:{create:{name:"Geral"}}}})}},23960:(e,t,r)=>{"use strict";r.d(t,{mergeDeepRight:()=>a.default});var a=r(95146)},69481:(e,t,r)=>{"use strict";r.d(t,{j:()=>i});var a=r(76031);let s=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,n=a.W,i=(e,t)=>r=>{var a;if((null==t?void 0:t.variants)==null)return n(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:i,defaultVariants:o}=t,d=Object.keys(i).map(e=>{let t=null==r?void 0:r[e],a=null==o?void 0:o[e];if(null===t)return null;let n=s(t)||s(a);return i[e][n]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,a]=t;return void 0===a||(e[r]=a),e},{});return n(e,d,null==t?void 0:null===(a=t.compoundVariants)||void 0===a?void 0:a.reduce((e,t)=>{let{class:r,className:a,...s}=t;return Object.entries(s).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...o,...c}[t]):({...o,...c})[t]===r})?[...e,r,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[2150,3422,8235,111,4391,1089,3573,2183,2520],()=>r(43654));module.exports=a})();