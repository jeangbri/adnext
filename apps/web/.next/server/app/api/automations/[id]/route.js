"use strict";(()=>{var e={};e.id=7753,e.ids=[7753],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},93426:(e,t,a)=>{a.r(t),a.d(t,{headerHooks:()=>j,originalPathname:()=>x,patchFetch:()=>f,requestAsyncStorage:()=>y,routeModule:()=>h,serverHooks:()=>w,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>v});var r={};a.r(r),a.d(r,{DELETE:()=>m,GET:()=>l,PUT:()=>p,runtime:()=>c});var n=a(22534),o=a(79409),i=a(36717),s=a(27445),u=a(38588),d=a(61242);let c="nodejs";async function l(e,{params:t}){let a=(0,d.e)(),{data:{user:r}}=await a.auth.getUser();if(!r)return s.Z.json({error:"Unauthorized"},{status:401});let n=await u._.automationRule.findUnique({where:{id:t.id},include:{actions:{orderBy:{order:"asc"}}}});return n?s.Z.json(n):s.Z.json({error:"Not found"},{status:404})}async function p(e,{params:t}){let a=(0,d.e)(),{data:{user:r}}=await a.auth.getUser();if(!r)return s.Z.json({error:"Unauthorized"},{status:401});let{name:n,keywords:o,matchType:i,matchOperator:c,priority:l,cooldownSeconds:p,isActive:m,actions:h,pageIds:y,triggerType:g,triggerConfig:w}=await e.json();try{let e=await u._.$transaction(async e=>(await e.automationRule.update({where:{id:t.id},data:{name:n,keywords:o,matchType:i,matchOperator:c,priority:l,cooldownSeconds:p,isActive:m,pageIds:y||[],triggerType:g,triggerConfig:w}}),await e.automationAction.deleteMany({where:{ruleId:t.id}}),h&&h.length>0&&await e.automationAction.createMany({data:h.map((e,a)=>({ruleId:t.id,type:e.type,payload:e.payload,delayMs:e.delayMs||0,order:a}))}),e.automationRule.findUnique({where:{id:t.id},include:{actions:{orderBy:{order:"asc"}}}})));return s.Z.json(e)}catch(e){return console.error(e),s.Z.json({error:e.message},{status:500})}}async function m(e,{params:t}){let a=(0,d.e)(),{data:{user:r}}=await a.auth.getUser();if(!r)return s.Z.json({error:"Unauthorized"},{status:401});try{return await u._.automationRule.delete({where:{id:t.id}}),s.Z.json({success:!0})}catch(e){return s.Z.json({error:e.message},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/automations/[id]/route",pathname:"/api/automations/[id]",filename:"route",bundlePath:"app/api/automations/[id]/route"},resolvedPagePath:"C:\\Users\\jeang\\OneDrive\\Desktop\\adnext\\apps\\web\\src\\app\\api\\automations\\[id]\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:g,serverHooks:w,headerHooks:j,staticGenerationBailout:v}=h,x="/api/automations/[id]/route";function f(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:g})}},38588:(e,t,a)=>{a.d(t,{_:()=>n});var r=a(53524);let n=globalThis.prisma??new r.PrismaClient({log:["error","warn"]})},61242:(e,t,a)=>{a.d(t,{e:()=>o});var r=a(51441),n=a(97705);function o(){let e=(0,n.cookies)(),t="https://fmxdqpukjuzhiseyobvz.supabase.co",a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZteGRxcHVranV6aGlzZXlvYnZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2Mjk4MjYsImV4cCI6MjA4NTIwNTgyNn0.bXEJnoTUSzAVDwQNwwiG1gmFc0rfK5M9xbKFMRb48BY";return t&&a||(console.warn("⚠️ Missing Supabase environment variables. Using fallback for build."),"build"!==process.env.npm_lifecycle_event&&t)?(0,r.lx)(t||"",a||"",{cookies:{get:t=>e.get(t)?.value,set(t,a,r){try{e.set({name:t,value:a,...r})}catch(e){}},remove(t,a){try{e.set({name:t,value:"",...a})}catch(e){}}}}):(0,r.lx)(t||"https://placeholder.supabase.co",a||"placeholder",{cookies:{get:()=>void 0,set:()=>{},remove:()=>{}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[2150,6363,3422],()=>a(93426));module.exports=r})();