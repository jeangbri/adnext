"use strict";(()=>{var e={};e.id=6023,e.ids=[6023],e.modules={53524:e=>{e.exports=require("@prisma/client")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},6005:e=>{e.exports=require("node:crypto")},12177:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>f,originalPathname:()=>k,patchFetch:()=>v,requestAsyncStorage:()=>g,routeModule:()=>d,serverHooks:()=>w,staticGenerationAsyncStorage:()=>b,staticGenerationBailout:()=>m});var o={};r.r(o),r.d(o,{GET:()=>h,POST:()=>p,runtime:()=>l});var n=r(22534),a=r(79409),s=r(36717),i=r(27445),u=r(6113),c=r.n(u);let l="nodejs";async function h(e){let t=e.nextUrl.searchParams,r=t.get("hub.mode"),o=t.get("hub.verify_token"),n=t.get("hub.challenge"),a=process.env.FB_MESSENGER_VERIFY_TOKEN;return"subscribe"===r&&o===a?(console.log("Messenger Webhook verified"),new i.Z(n,{status:200})):new i.Z("Forbidden",{status:403})}async function p(e){let t=e.headers.get("x-hub-signature-256"),o=await e.text(),n=process.env.FB_APP_SECRET,a=!1;try{a=function(e,t,r){if(!t)return!1;let o="sha256="+c().createHmac("sha256",r).update(e).digest("hex");return c().timingSafeEqual(Buffer.from(t),Buffer.from(o))}(o,t||"",n)}catch(e){a=!1}if(!a)return console.warn("Invalid Signature on Webhook"),new i.Z("Invalid Signature",{status:401});let s={};try{s=JSON.parse(o)}catch(e){return new i.Z("Invalid JSON",{status:400})}try{let{processMessengerEvent:e}=await r.e(8105).then(r.bind(r,58105));await e(s)}catch(e){console.error("Processing failed",e)}try{let{getDueExecutions:e}=await r.e(6076).then(r.bind(r,76076)),{processExecution:t}=await Promise.all([r.e(8105),r.e(8163)]).then(r.bind(r,98163)),o=await e(10);if(o.length>0)for(let e of(console.log(`[Webhook Sweep] Found ${o.length} due executions`),o))try{await t(e)}catch(t){console.error(`[Webhook Sweep] Failed ${e}`,t)}}catch(e){console.error("[Webhook Sweep] Error",e)}return i.Z.json({ok:!0})}let d=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/webhooks/messenger/route",pathname:"/api/webhooks/messenger",filename:"route",bundlePath:"app/api/webhooks/messenger/route"},resolvedPagePath:"C:\\Users\\jeang\\OneDrive\\Desktop\\adnext\\apps\\web\\src\\app\\api\\webhooks\\messenger\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:b,serverHooks:w,headerHooks:f,staticGenerationBailout:m}=d,k="/api/webhooks/messenger/route";function v(){return(0,s.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:b})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[2150,6363],()=>r(12177));module.exports=o})();