"use strict";(()=>{var e={};e.id=1792,e.ids=[1792],e.modules={53524:e=>{e.exports=require("@prisma/client")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},8704:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>v,originalPathname:()=>k,patchFetch:()=>y,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>g,staticGenerationBailout:()=>x});var a={};r.r(a),r.d(a,{POST:()=>m,dynamic:()=>l});var s=r(22534),n=r(79409),i=r(36717),o=r(27445),c=r(38588),u=r(61242),p=r(11455),d=r(59609);let l="force-dynamic";async function m(e){let t;let r=(0,u.e)(),{data:{user:a}}=await r.auth.getUser();if(!a)return o.Z.json({error:"Unauthorized"},{status:401});let s=await (0,p.A)(a.id,a.email||""),{pageId:n}=await e.json().catch(()=>({}));if(!(t=n?await c._.messengerPage.findFirst({where:{workspaceId:s.id,pageId:n,isActive:!0}}):await c._.messengerPage.findFirst({where:{workspaceId:s.id,isActive:!0}})))return o.Z.json({error:"Page not found or not active"},{status:404});let i=await c._.contact.findFirst({where:{workspaceId:s.id},orderBy:{lastSeenAt:"desc"}});if(!i)return o.Z.json({error:"Nenhum contato encontrado para teste. Envie uma mensagem para a p\xe1gina primeiro."},{status:404});try{let e=(0,d.p)(t.pageAccessToken),r=`https://graph.facebook.com/v19.0/me/messages?access_token=${e}`,a=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipient:{id:i.psid},message:{text:"Teste AdNext: Integra\xe7\xe3o funcionando! \uD83D\uDE80"}})}),s=await a.json();if(s.error)throw Error(s.error.message);return o.Z.json({success:!0,recipient:i.firstName||i.psid})}catch(e){return o.Z.json({error:e.message},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/test/send/route",pathname:"/api/test/send",filename:"route",bundlePath:"app/api/test/send/route"},resolvedPagePath:"C:\\Users\\jeang\\OneDrive\\Desktop\\adnext\\apps\\web\\src\\app\\api\\test\\send\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:h,staticGenerationAsyncStorage:g,serverHooks:w,headerHooks:v,staticGenerationBailout:x}=f,k="/api/test/send/route";function y(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:g})}},59609:(e,t,r)=>{r.d(t,{H:()=>o,p:()=>c});var a=r(6113),s=r.n(a);let n="aes-256-cbc",i=process.env.APP_ENCRYPTION_KEY||"12345678901234567890123456789012";function o(e){let t=s().randomBytes(16),r=s().createCipheriv(n,Buffer.from(i),t),a=r.update(e);return a=Buffer.concat([a,r.final()]),t.toString("hex")+":"+a.toString("hex")}function c(e){let t=e.split(":"),r=Buffer.from(t.shift(),"hex"),a=Buffer.from(t.join(":"),"hex"),o=s().createDecipheriv(n,Buffer.from(i),r),c=o.update(a);return(c=Buffer.concat([c,o.final()])).toString()}},38588:(e,t,r)=>{r.d(t,{_:()=>s});var a=r(53524);let s=globalThis.prisma??new a.PrismaClient({log:["error","warn"]})},61242:(e,t,r)=>{r.d(t,{e:()=>n});var a=r(51441),s=r(97705);function n(){let e=(0,s.cookies)(),t="https://fmxdqpukjuzhiseyobvz.supabase.co",r="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZteGRxcHVranV6aGlzZXlvYnZ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2Mjk4MjYsImV4cCI6MjA4NTIwNTgyNn0.bXEJnoTUSzAVDwQNwwiG1gmFc0rfK5M9xbKFMRb48BY";return t&&r||(console.warn("⚠️ Missing Supabase environment variables. Using fallback for build."),"build"!==process.env.npm_lifecycle_event&&t)?(0,a.lx)(t||"",r||"",{cookies:{get:t=>e.get(t)?.value,set(t,r,a){try{e.set({name:t,value:r,...a})}catch(e){}},remove(t,r){try{e.set({name:t,value:"",...r})}catch(e){}}}}):(0,a.lx)(t||"https://placeholder.supabase.co",r||"placeholder",{cookies:{get:()=>void 0,set:()=>{},remove:()=>{}}})}},11455:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(38588);async function s(e,t){let r=await a._.workspaceMember.findFirst({where:{userId:e},include:{workspace:!0}});if(r)return r.workspace;let s=await a._.user.findUnique({where:{id:e}});if(!s){if(t)s=await a._.user.create({data:{id:e,email:t}});else throw Error("User not found and no email provided")}return await a._.workspace.create({data:{name:"Meu Workspace",ownerId:e,members:{create:{userId:e,role:"OWNER"}},workflowFolders:{create:{name:"Geral"}}}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[2150,6363,3422],()=>r(8704));module.exports=a})();