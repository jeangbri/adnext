"use strict";exports.id=8163,exports.ids=[8163],exports.modules={98163:(e,r,o)=>{o.d(r,{processExecution:()=>a});var s=o(76076),t=o(58105),n=o(38588);async function a(e){let r=await (0,s.x0)(e);if(!r)return console.log(`[Processor] State not found for ${e}`),{status:"NOT_FOUND"};if(Date.now()<r.runAt-5e3)return{status:"TOO_EARLY",runAt:r.runAt};if(!await (0,s.vm)(e))return console.log(`[Processor] Could not acquire lock for ${e} (already processing or done)`),{status:"ALREADY_PROCESSING"};let o=await n._.messengerPage.findUnique({where:{pageId:r.pageId},include:{workspace:!0}});if(!o||!o.isActive)return console.log(`[Processor] Page ${r.pageId} inactive or missing`),await (0,s.mO)(e),{status:"PAGE_INACTIVE"};let a=await n._.contact.findUnique({where:{pageId_psid:{pageId:r.pageId,psid:r.psid}}});if(!a)return console.log(`[Processor] Contact ${r.psid} missing`),await (0,s.mO)(e),{status:"CONTACT_MISSING"};let i=await n._.automationRule.findUnique({where:{id:r.ruleId},include:{actions:{orderBy:{order:"asc"}}}});if(!i||!i.isActive)return console.log(`[Processor] Rule ${r.ruleId} inactive or missing`),await (0,s.mO)(e),{status:"RULE_INACTIVE"};try{return console.log(`[Processor] Resuming execution ${e} (Index: ${r.nextIndex})`),await (0,t.q)(i,o,a,r.nextIndex,e,r.refLogId||"runner",r.replyToCommentId,!0),{status:"SUCCESS"}}catch(r){return console.error(`[Processor] Execution ${e} failed`,r),await (0,s.VQ)(e,r.message||"Unknown error"),{status:"ERROR",error:r.message}}}}};